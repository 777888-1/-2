<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ゴール内自動ランダムスポット</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* 明るい青灰色の背景 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* 画面の高さ全体を使う */
            padding: 1rem; /* 全体のパディング */
            overflow: hidden; /* 画面のスクロールを防止 */
        }

        /* アプリコンテナのレスポンシブ設定 */
        .app-container {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            max-width: 95vw; /* 画面幅の95% */
            max-height: 95vh; /* 画面高さの95% */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* ゴール表示エリアのスタイル (シンプル枠) */
        #soccerGoalContainer {
            position: relative;
            /* 実際のゴール比率 7.35m (幅) : 2.45m (高さ) = 3:1 を維持 */
            width: 80vw; /* ビューポート幅の80%をゴール幅の基準に */
            padding-top: calc(80vw / 3); /* 幅の1/3の高さで3:1の縦横比を維持 */
            max-width: 735px; /* 最大幅 (7.35m) */
            max-height: 245px; /* 最大高さ (2.45m) */
            
            background-color: white; /* 背景は白 */
            border: 4px solid #333; /* 枠線 */
            box-shadow: inset 0 0 15px rgba(0,0,0,0.1); /* 内側の影 */
            margin-bottom: 2rem;
            overflow: hidden; /* 点が枠外に出ないように */
            border-radius: 0.5rem; /* 角を丸く */
        }

        /* ランダムな点のスタイル */
        #randomSpot {
            position: absolute;
            width: 12px; /* 点のサイズを小さく (20px -> 12px) */
            height: 12px; /* 点のサイズ */
            background-color: #ef4444; /* 赤色 */
            border-radius: 50%; /* 円形 */
            box-shadow: 0 0 10px 3px rgba(239, 68, 68, 0.8), 0 0 3px rgba(239, 68, 68, 0.5); /* 影も調整 */
            transform: translate(-50%, -50%); /* 中央揃え */
            transition: all 0.2s ease-out; /* 位置変更のアニメーション */
            display: none; /* 初期状態では非表示 */
            z-index: 10; /* 最前面に表示 */
        }

        /* レスポンシブ調整 */
        @media (max-width: 768px) {
            .app-container {
                padding: 1rem;
            }
            #soccerGoalContainer {
                width: 95vw; /* 小さい画面では幅を広げる */
                padding-top: calc(95vw / 3);
            }
        }
    </style>
</head>
<body>
    <div class="app-container text-center">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">ゴール内自動ランダムスポット</h1>
        <p class="text-gray-600 mb-8">「開始」ボタンでゴール内にランダムな点が自動生成されます。</p>

        <!-- Soccer Goal Display Area -->
        <div id="soccerGoalContainer">
            <!-- Random Spot -->
            <div id="randomSpot"></div>
        </div>

        <!-- Control Buttons -->
        <div class="flex justify-center gap-4 mb-4 w-full">
            <button id="startBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                開始
            </button>
            <button id="stopBtn" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-8 rounded-lg shadow-3xl transition duration-300 ease-in-out transform hover:scale-105" disabled>
                停止
            </button>
        </div>

        <!-- Info Display Area -->
        <div id="infoDisplay" class="text-lg text-gray-700 font-medium mt-4 min-h-[30px]">
            準備完了
        </div>
    </div>

    <script>
        // Get DOM elements
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const randomSpot = document.getElementById('randomSpot');
        const infoDisplay = document.getElementById('infoDisplay');
        const soccerGoalContainer = document.getElementById('soccerGoalContainer');

        let intervalId = null; // Holds the setInterval ID
        let hideTimeoutId = null; // Holds the setTimeout ID for hiding the marker
        let isDisplayingSpot = false; // Flag to track if the spot is currently displayed

        // 変更点: 表示時間とブランク時間を短縮
        const spotDisplayDuration = 1000; // 結果の表示時間 (1秒)
        const blankDuration = 1000;      // ブランク（非表示）時間 (1秒)
        const totalCycleTime = spotDisplayDuration + blankDuration; // 1サイクル合計時間 (2秒)

        // Constants for goal dimensions and exclusion
        const GOAL_WIDTH_M = 7.35;
        const GOAL_HEIGHT_M = 2.45; // To maintain 3:1 ratio for 7.35m width
        const EXCLUDE_CENTER_WIDTH_M = 3.0; // 中央3メートルを除外

        // Calculate exclusion zone boundaries in percentage of goal width
        const EXCLUDE_LEFT_PERCENT = ((GOAL_WIDTH_M - EXCLUDE_CENTER_WIDTH_M) / 2) / GOAL_WIDTH_M * 100; // 約29.59%
        const EXCLUDE_RIGHT_PERCENT = (GOAL_WIDTH_M - ((GOAL_WIDTH_M - EXCLUDE_CENTER_WIDTH_M) / 2)) / GOAL_WIDTH_M * 100; // 約70.41%

        // シュートコースのゾーン定義と確率 (中央3m除外)
        const shootingZones = [
            // 下段 (地面に近いコース)
            { id: '左下隅 (ニアロー)', prob: 20, xRanges: [{ min: 0, max: EXCLUDE_LEFT_PERCENT }], yMin: 0, yMax: 33.33 },
            { id: '右下隅 (ファーロー)', prob: 20, xRanges: [{ min: EXCLUDE_RIGHT_PERCENT, max: 100 }], yMin: 0, yMax: 33.33 },

            // 中段 (キーパーの体幹付近) - 中央は除外
            { id: '左中段 (ニアミドル)', prob: 15, xRanges: [{ min: 0, max: EXCLUDE_LEFT_PERCENT }], yMin: 33.33, yMax: 66.67 },
            { id: '右中段 (ファーミドル)', prob: 15, xRanges: [{ min: EXCLUDE_RIGHT_PERCENT, max: 100 }], yMin: 33.33, yMax: 66.67 },

            // 上段 (クロスバーに近いコース) - 中央は除外
            { id: '左上隅 (ニアハイ)', prob: 15, xRanges: [{ min: 0, max: EXCLUDE_LEFT_PERCENT }], yMin: 66.67, yMax: 100 },
            { id: '右上隅 (ファーハイ)', prob: 15, xRanges: [{ min: EXCLUDE_RIGHT_PERCENT, max: 100 }], yMin: 66.67, yMax: 100 }
        ];
        // 合計確率 = 100%

        /**
         * 確率に基づいてランダムなシューティングゾーンを選択します。
         * @returns {object} 選択されたゾーンオブジェクト
         */
        function getRandomZone() {
            let rand = Math.random() * 100;
            let cumulativeProb = 0;
            for (let i = 0; i < shootingZones.length; i++) {
                cumulativeProb += shootingZones[i].prob;
                if (rand < cumulativeProb) {
                    return shootingZones[i];
                }
            }
            return shootingZones[0]; // Fallback
        }

        /**
         * 選択されたゾーン内でランダムな座標を生成します。
         * @returns {{x: number, y: number, zoneId: string}} 生成された座標とゾーンID
         */
        function generateShooterPosition() {
            const zone = getRandomZone();
            
            // ゴールコンテナの実際の幅と高さを取得
            const goalWidthPx = soccerGoalContainer.offsetWidth;
            const goalHeightPx = soccerGoalContainer.offsetHeight;
            const spotSizePx = randomSpot.offsetWidth; // 変更点: CSSで設定された新しいサイズを取得

            let x_percent, y_percent;

            // Generate x-coordinate from one of the zone's xRanges
            const selectedXRange = zone.xRanges[0];
            x_percent = Math.random() * (selectedXRange.max - selectedXRange.min) + selectedXRange.min;
            
            // Generate y-coordinate from the zone's yMin/yMax
            y_percent = Math.random() * (zone.yMax - zone.yMin) + zone.yMin;

            // Convert percentage coordinates to pixel coordinates relative to goal container
            // Adjust for spot size so the spot's center is within the goal boundaries
            const calculated_top_px = (100 - y_percent) / 100 * goalHeightPx;
            const left_px = (x_percent / 100) * goalWidthPx;

            return { x: left_px, y: calculated_top_px, zoneId: zone.id };
        }

        /**
         * Starts the automatic generation cycle.
         */
        function startGenerationCycle() {
            // Clear any previous hide timeout
            if (hideTimeoutId) {
                clearTimeout(hideTimeoutId);
            }

            if (isDisplayingSpot) {
                // Phase 1: Display the spot
                const { x, y, zoneId } = generateShooterPosition();
                randomSpot.style.left = `${x}px`;
                randomSpot.style.top = `${y}px`;
                randomSpot.style.display = 'block'; // Show the spot
                infoDisplay.textContent = `シュート！`; // 変更点: 名称表示を削除
                isDisplayingSpot = false; // Next phase will be blank
            } else {
                // Phase 2: Display blank
                randomSpot.style.display = 'none'; // Hide the spot
                infoDisplay.textContent = '次へ...';
                isDisplayingSpot = true; // Next phase will be spot display
            }
        }

        // Event listener for the Start button
        startBtn.addEventListener('click', () => {
            // Clear any existing interval
            if (intervalId) {
                clearInterval(intervalId);
            }

            // Update UI state
            startBtn.disabled = true;
            stopBtn.disabled = false;

            // Initial display immediately
            isDisplayingSpot = true; // Set flag to display spot first
            startGenerationCycle();

            // Start the cycle: totalCycleTime (2000ms) for each full cycle (spot + blank)
            intervalId = setInterval(startGenerationCycle, totalCycleTime);
        });

        // Event listener for the Stop button
        stopBtn.addEventListener('click', () => {
            clearInterval(intervalId); // Stop automatic generation
            clearTimeout(hideTimeoutId); // Clear any active hide timeout
            intervalId = null;          // Reset ID
            isDisplayingSpot = false;   // Reset flag
            
            // Reset UI state
            startBtn.disabled = false;
            stopBtn.disabled = true;
            randomSpot.style.display = 'none'; // Hide the spot
            infoDisplay.textContent = '停止しました'; // Show stop message
        });

        // Initial display message
        infoDisplay.textContent = 'ボタンを押して開始';
    </script>
</body>
</html>
